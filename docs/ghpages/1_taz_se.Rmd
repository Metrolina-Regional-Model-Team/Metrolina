---
title: "TAZs and Socioeconomic Data"
output:
  html_document:
    theme: cosmo
    highlight: tango
    css: "styles.css"
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: true
      number_sections: false
    toc_depth: 3
---

The Traffic Analysis Zone (TAZ) layer is a geographic unit that represents a small area within the Metrolina region. It stores information related to the socioeconomic database and serves as the origin and destination for all tours. Each TAZ has a TAZ ID number that can be joined with the socioeconomic database. 

## TAZ Database 

The TAZ structure consists of 3,896 zones and spans 13 counties. Each TAZ is connected to the highway networks by centroid connectors. The TAZs were updated to align with the new 2020 US Census geographies and the addition of Anson County to the model region. This process involved the reshaping and splitting of the previous TAZ structure, adding and relocating centroids and centroid connectors, and a review/ revision process with regional partners.  

External zones are defined using a polygon-based method. This means external stations are drawn as cordon TAZs just outside the study area, where traffic enters and exits. 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(sf)
library(leaflet)
library(dplyr)
```

```{r load-and-process-data, warning=FALSE, message=FALSE, results='hide'}
invisible(capture.output({
  TAZ3578 <- st_read("C:/MRM/docs/ghpages/other/shps/TAZ3578/TAZ3578.shp")
  TAZ3896 <- st_read("C:/MRM/docs/ghpages/other/shps/TAZ3896/TAZ3896.shp")

# Ensure both shapefiles are in the same CRS (WGS84)
  TAZ3578 <- st_transform(TAZ3578, 4326)
  TAZ3896 <- st_transform(TAZ3896, 4326)
}))
```

```{r create-map}
# Create the interactive map
map <- leaflet() %>%
  # Add base tiles
  addTiles() %>%
  
  # Add first shapefile
  addPolygons(
    data = TAZ3578,
    color = "blue",
    weight = 1,
    opacity = 1,
    fillOpacity = 0,
    highlightOptions = highlightOptions(
      color = "white",
      weight = 3,
      bringToFront = TRUE
    ),
    label = ~paste("TAZ3578:", TAZ),
    group = "TAZ3578",
    labelOptions = labelOptions(noHide = FALSE, direction = "auto")
  ) %>%
  
  # Add second shapefile
  addPolygons(
    data = TAZ3896,
    color = "red",
    weight = 1,
    opacity = 1,
    fillOpacity = 0,
    highlightOptions = highlightOptions(
      color = "white",
      weight = 3,
      bringToFront = TRUE
    ),
    label = ~paste("TAZ3896:", TAZ),
    group = "TAZ3896",
    labelOptions = labelOptions(noHide = FALSE, direction = "auto")
  ) %>%
  
  # Add layers control
  addLayersControl(
    overlayGroups = c("TAZ3578", "TAZ3896"),
    options = layersControlOptions(collapsed = FALSE)
  )

# Display the map
map

```

## Socioeconomic Database 

The Socioeconomic (SE) or land use data is a primary an input into the travel demand model. The SE data consists of estimates of population, households, student enrollment and employment. This information was developed by ....   

The household data consists of: 

* Households 
* Total Population 
* Household Population 
* Median Household Income  
* Group Quarter Population 

The employment data consists of eight primary categories of employment and correspond to the the North American Industry Classification System (NAICS). 

* Low-Traffic Industrial Jobs  
* High-Traffic Industrial 
* Retail 
* High-Traffic Retail 
* Low-Traffic Service 
* High-Traffic Service 
* Education 
* Office  

[View MRM - NAICS](other/pdfs/NAICS.pdf)

## Area Type
Area type is one of the inputs to the speed and capacity calculations of the network. Area type is calculated based on residential and employment density within a 1.5-mile radius of the TAZ center.  

Each TAZ is assigned one of five area types: 

* Central Business District (CBD)
* Central Business District Fringe/Other Business District (OBD)
* Urban
* Suburban
* Rural  

The table below shows the criteria used for each area type. 
```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(knitr)
library(kableExtra)

# Create the header for employment density
employment_header <- c("Employment Density (Employment/Square mile)")
sub_header <- c("0-2,600", ">2,600", ">10,500")

# Create the main data frame
df <- data.frame(
  "Population.Density" = c("Less than 375", "Greater than or equal to 375"),
  "Col1" = c("Rural (5)", 
             "Urban (3) - If POPDEN\n+ EMPDEN/1.6 is\ngreater than 2,100\n\nSuburban (4) - If\nPOPDEN +\nEMPDEN/1.6 is less\nthan or equal to 2,100"),
  "Col2" = c("CBD Fringe/OBD (2)", "CBD Fringe/OBD (2)"),
  "Col3" = c("CBD (1)", "CBD (1)")
)

# Create the table
table <- kable(df, format = "html", escape = FALSE,
               col.names = c("Population Density\n(Population/Square mile)", 
                           sub_header)) %>%
  kable_styling(bootstrap_options = c("bordered"),
                full_width = TRUE,
                font_size = 14) %>%
  add_header_above(c(" " = 1, 
                    "Employment Density (Employment/Square mile)" = 3)) %>%
  column_spec(1, width = "200px", background = "#FFFFFF") %>%
  column_spec(2, width = "200px", background = "#FFFFFF") %>%
  column_spec(3, width = "200px", background = "#FFFFFF") %>%
  column_spec(4, width = "200px", background = "#FFFFFF") %>%
  row_spec(0, bold = TRUE, background = "#f7f7f7") %>%
  row_spec(1:nrow(df), background = "#FFFFFF") %>%
  collapse_rows(columns = c(3,4), valign = "middle")

# Display the table
table

```